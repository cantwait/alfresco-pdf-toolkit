if(typeof PDFToolkit=="undefined"||!PDFToolkit){var PDFToolkit={}}(function(){var e=YAHOO.util.Dom,t=YAHOO.util.Selector,n=YAHOO.util.Event;var r=Alfresco.util.encodeHTML,i=Alfresco.util.hasEventInterest;PDFToolkit.RuleConfigActionCustom=function(e){PDFToolkit.RuleConfigActionCustom.superclass.constructor.call(this,e);this.name="PDFToolkit.RuleConfigActionCustom";Alfresco.util.ComponentManager.reregister(this);this.customisations=YAHOO.lang.merge(this.customisations,PDFToolkit.RuleConfigActionCustom.superclass.customisations);this.renderers=YAHOO.lang.merge(this.renderers,PDFToolkit.RuleConfigActionCustom.superclass.renderers);return this};YAHOO.extend(PDFToolkit.RuleConfigActionCustom,Alfresco.RuleConfigAction,{customisations:{PDFAppend:{text:function(e,t,n){this._getParamDef(e,"destination-folder")._type="path";this._getParamDef(e,"target-node")._type="path";return e},edit:function(e,t,n){this._getParamDef(e,"destination-folder")._type="hidden";this._getParamDef(e,"target-node")._type="hidden";e.parameterDefinitions.splice(0,0,{type:"pdftoolkit:select-file-dialog-button",displayLabel:this.msg("pdftoolkit.append.target-node"),_buttonLabel:this.msg("pdftoolkit.select-node"),_destinationParam:"target-node"},{type:"pdftoolkit:destination-dialog-button",displayLabel:this.msg("pdftoolkit.destination-folder"),_buttonLabel:this.msg("pdftoolkit.select-folder"),_destinationParam:"destination-folder"});return e}},PDFSplitAtPage:{text:function(e,t,n){this._getParamDef(e,"destination-folder")._type="path";return e},edit:function(e,t,n){this._getParamDef(e,"destination-folder")._type="hidden";e.parameterDefinitions.splice(0,0,{type:"pdftoolkit:destination-dialog-button",displayLabel:this.msg("pdftoolkit.destination-folder"),_buttonLabel:this.msg("pdftoolkit.select-folder"),_destinationParam:"destination-folder"});return e}},PDFSignature:{text:function(e,t,n){this._getParamDef(e,"destination-folder")._type="path";this._getParamDef(e,"private-key")._type="path";return e},edit:function(e,t,n){this._getParamDef(e,"destination-folder")._type="hidden";this._getParamDef(e,"private-key")._type="hidden";e.parameterDefinitions.splice(0,0,{type:"pdftoolkit:select-file-dialog-button",displayLabel:this.msg("pdftoolkit.signature.private-key"),_buttonLabel:this.msg("pdftoolkit.select-node"),_destinationParam:"private-key"},{type:"pdftoolkit:destination-dialog-button",displayLabel:this.msg("pdftoolkit.destination-folder"),_buttonLabel:this.msg("pdftoolkit.select-folder"),_destinationParam:"destination-folder"});return e}},PDFSplit:{text:function(e,t,n){this._getParamDef(e,"destination-folder")._type="path";return e},edit:function(e,t,n){this._getParamDef(e,"destination-folder")._type="hidden";e.parameterDefinitions.splice(0,0,{type:"pdftoolkit:destination-dialog-button",displayLabel:this.msg("pdftoolkit.destination-folder"),_buttonLabel:this.msg("pdftoolkit.select-folder"),_destinationParam:"destination-folder"});return e}},PDFInsertAtPage:{text:function(e,t,n){this._getParamDef(e,"destination-folder")._type="path";this._getParamDef(e,"insert-content")._type="path";return e},edit:function(e,t,n){this._getParamDef(e,"destination-folder")._type="hidden";this._getParamDef(e,"insert-content")._type="hidden";e.parameterDefinitions.splice(0,0,{type:"pdftoolkit:select-file-dialog-button",displayLabel:this.msg("pdftoolkit.insert.target-node"),_buttonLabel:this.msg("pdftoolkit.select-node"),_destinationParam:"insert-content"},{type:"pdftoolkit:destination-dialog-button",displayLabel:this.msg("pdftoolkit.destination-folder"),_buttonLabel:this.msg("pdftoolkit.select-folder"),_destinationParam:"destination-folder"});return e}},PDFWatermark:{text:function(e,t,n){this._getParamDef(e,"destination-folder")._type="path";this._getParamDef(e,"watermark-image")._type="path";return e},edit:function(e,t,n){this._getParamDef(e,"destination-folder")._type="hidden";this._getParamDef(e,"watermark-image")._type="hidden";e.parameterDefinitions.splice(0,0,{type:"pdftoolkit:select-file-dialog-button",displayLabel:this.msg("pdftoolkit.watermark.image"),_buttonLabel:this.msg("pdftoolkit.select-node"),_destinationParam:"watermark-image"},{type:"pdftoolkit:destination-dialog-button",displayLabel:this.msg("pdftoolkit.destination-folder"),_buttonLabel:this.msg("pdftoolkit.select-folder"),_destinationParam:"destination-folder"});return e}},PDFEncryption:{text:function(e,t,n){this._getParamDef(e,"destination-folder")._type="path";return e},edit:function(e,t,n){this._getParamDef(e,"destination-folder")._type="hidden";e.parameterDefinitions.splice(0,0,{type:"pdftoolkit:destination-dialog-button",displayLabel:this.msg("pdftoolkit.destination-folder"),_buttonLabel:this.msg("pdftoolkit.select-folder"),_destinationParam:"destination-folder"});return e}},PDFDeletePage:{text:function(e,t,n){this._getParamDef(e,"destination-folder")._type="path";return e},edit:function(e,t,n){this._getParamDef(e,"destination-folder")._type="hidden";e.parameterDefinitions.splice(0,0,{type:"pdftoolkit:destination-dialog-button",displayLabel:this.msg("pdftoolkit.destination-folder"),_buttonLabel:this.msg("pdftoolkit.select-folder"),_destinationParam:"destination-folder"});return e}}},renderers:{"pdftoolkit:select-file-dialog-button":{manual:{edit:true},currentCtx:{},edit:function(e,t,n,r,i){if(!this.widgets.selectedFileDialog){this.widgets.selectedFileDialog=new Alfresco.module.DocumentPicker(this.id+"-fileDialog");var s=Alfresco.constants.PROXY_URI+"slingshot/doclib/container/"+this.options.siteId+"/documentlibrary";Alfresco.util.Ajax.jsonGet({url:s,successCallback:{fn:function(e){var t=e.json.container.nodeRef;o.widgets.selectedFileDialog.setOptions({displayMode:"items",itemFamily:"node",itemType:"cm:content",multipleSelectMode:false,parentNodeRef:t,restrictParentNavigationToDocLib:false});o.widgets.selectedFileDialog.onComponentsLoaded()}},failureCallback:{fn:function(e){var t="alfresco://company/home";o.widgets.selectedFileDialog.setOptions({displayMode:"items",itemFamily:"node",itemType:"cm:content",multipleSelectMode:false,parentNodeRef:t,restrictParentNavigationToDocLib:false});o.widgets.selectedFileDialog.onComponentsLoaded()}}})}var o=this;this._createLabel(n.displayLabel,e);var u=r.parameterValues?r.parameterValues[n._destinationParam]:null;this._createPathSpan(e,t,n,this.id+"-"+t._id+"-fileLabel",u);this._createButton(e,t,n,r,function(t,n){this.widgets.selectedFileDialog.singleSelectedItem=null;this.renderers["pdftoolkit:select-file-dialog-button"].currentCtx={configDef:n.configDef,ruleConfig:n.ruleConfig,paramDef:n.paramDef};YAHOO.Bubbling.on("onDocumentsSelected",function(e,t){if(t&&t[1].items){var n=t[1].items[0];if(n!=null){var r=this.renderers["pdftoolkit:select-file-dialog-button"].currentCtx;this._setHiddenParameter(r.configDef,r.ruleConfig,r.paramDef._destinationParam,n.nodeRef);Alfresco.util.ComponentManager.get(this.id+"-"+r.configDef._id+"-fileLabel").displayByPath(n.name,n.displayPath);this._updateSubmitElements(r.configDef)}}},this);this.widgets.selectedFileDialog.onShowPicker()})}},"pdftoolkit:destination-dialog-button":{manual:{edit:true},currentCtx:{},edit:function(e,t,n,r,s){this._createLabel(n.displayLabel,e);var o=r.parameterValues?r.parameterValues[n._destinationParam]:null;this._createPathSpan(e,t,n,this.id+"-"+t._id+"-destinationLabel",o);this._createButton(e,t,n,r,function(t,n){this.renderers["pdftoolkit:destination-dialog-button"].currentCtx={configDef:n.configDef,ruleConfig:n.ruleConfig,paramDef:n.paramDef};if(!this.widgets.pdfDestinationDialog){this.widgets.pdfDestinationDialog=new Alfresco.module.DoclibGlobalFolder(this.id+"-destinationDialog");this.widgets.pdfDestinationDialog.setOptions({title:this.msg("dialog.destination.title")});YAHOO.Bubbling.on("folderSelected",function(e,t){if(i(this.widgets.pdfDestinationDialog,t)){var n=t[1].selectedFolder;if(n!==null){var r=this.renderers["pdftoolkit:destination-dialog-button"].currentCtx;this._setHiddenParameter(r.configDef,r.ruleConfig,r.paramDef._destinationParam,n.nodeRef);Alfresco.util.ComponentManager.get(this.id+"-"+r.configDef._id+"-destinationLabel").displayByPath(n.path,n.siteId,n.siteTitle);this._updateSubmitElements(r.configDef)}}},this)}var r=this._getParameters(n.configDef)["destination-folder"],s=[Alfresco.module.DoclibGlobalFolder.VIEW_MODE_SITE];if(this.options.repositoryBrowsing===true){s.push(Alfresco.module.DoclibGlobalFolder.VIEW_MODE_REPOSITORY,Alfresco.module.DoclibGlobalFolder.VIEW_MODE_USERHOME)}this.widgets.pdfDestinationDialog.setOptions({allowedViewModes:s,nodeRef:this.options.rootNode,pathNodeRef:r?new Alfresco.util.NodeRef(r):null});this.widgets.pdfDestinationDialog.showDialog()})}}}})})()